DROP TABLE IF EXISTS users;
DROP TABLE IF EXISTS roles;
DROP TABLE IF EXISTS claims;
DROP TABLE IF EXISTS tokens;

CREATE TABLE users (
    id BIGINT PRIMARY KEY,
    name VARCHAR(80),
    surname VARCHAR(80),
    login VARCHAR(15),
    password VARCHAR(80),
    phone VARCHAR(30) UNIQUE
);

CREATE TABLE roles (
    id BIGINT PRIMARY KEY,
    name VARCHAR(20) NOT NULL UNIQUE
);


CREATE TABLE claims (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    user_from BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    description TEXT,
    status VARCHAR(15)
);

CREATE TABLE tokens(
    id BIGSERIAL PRIMARY KEY,
    token VARCHAR(500) NOT NULL
);

CREATE UNIQUE INDEX tokenIndex ON tokens(token);

CREATE TABLE users_roles (
    user_id BIGINT REFERENCES users(id) ON DELETE CASCADE,
    role_id BIGINT REFERENCES roles(id) ON DELETE CASCADE,
    PRIMARY KEY(user_id, role_id)
);

INSERT INTO users VALUES(1, 'Ivan', 'Ivanov', 'admin', '$2a$12$cAxIcl5TnODk58B/nIpA1u09omMW3xdZ4khNMjyxH0PT8fnDp9dqC', '111');
INSERT INTO users VALUES(2, 'Petr', 'Petrov', 'operator', '$2a$12$cAxIcl5TnODk58B/nIpA1u09omMW3xdZ4khNMjyxH0PT8fnDp9dqC', '222');
INSERT INTO users VALUES(3, 'Sidor', 'Sidorov', 'user', '$2a$12$cAxIcl5TnODk58B/nIpA1u09omMW3xdZ4khNMjyxH0PT8fnDp9dqC', '333');
INSERT INTO users VALUES(4, 'Roman', 'Rogov', 'user1', '$2a$12$cAxIcl5TnODk58B/nIpA1u09omMW3xdZ4khNMjyxH0PT8fnDp9dqC', '444');

INSERT INTO roles VALUES(1, 'ADMIN');
INSERT INTO roles VALUES(2, 'OPERATOR');
INSERT INTO roles VALUES(3, 'USER');

INSERT INTO users_roles VALUES(1, 1);
INSERT INTO users_roles VALUES(2, 2);
INSERT INTO users_roles VALUES(3, 3);
INSERT INTO users_roles VALUES(4, 3);

INSERT INTO claims(user_from, description, status) VALUES(3, 'test claim', 'DRAFT');
INSERT INTO claims(user_from, description, status) VALUES(4, 'test claim from second user', 'DRAFT');
INSERT INTO claims(user_from, description, status) VALUES(3, 'test claim', 'SENT');
INSERT INTO claims(user_from, description, status) VALUES(4, 'test claim from second user', 'SENT');